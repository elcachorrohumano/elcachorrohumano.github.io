<!DOCTYPE html>
<html lang="{{ page.lang | default: site.lang | default: "en" }}">
<head>
  <title>{% if page.title %}{{ page.title | escape }} | {% endif %}{{ site.title | escape }}</title>
  <meta charset="{{ site.encoding | default: "utf-8" }}">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="author" content="{{ page.author | default: site.author | escape }}">
  <meta name="description" content="{{ page.description | default: site.description | escape }}">
  <meta name="generator" content="Jekyll v{{ jekyll.version }}">
  <link rel="canonical" href="{{ page.url | absolute_url }}">
  
  <!-- Google Fonts: DM Sans + Shippori Mincho -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700;1,9..40,400;1,9..40,500&family=Shippori+Mincho:wght@400;500;600&display=swap" rel="stylesheet">
  
  <link rel="stylesheet" href="{{ "/assets/css/index.css" | relative_url }}">
  {% if site.plugins contains "jekyll-feed" %}<link rel="alternate" href="{{ site.feed.path | default: "/feed.xml" | relative_url }}" type="application/atom+xml" title="{{ site.title }}">{% endif %}
  {% if page.mathjax or site.mathjax %}
  <link rel="stylesheet" href="{{ "/assets/katex/katex.min.css" | relative_url }}">
  <script defer src="{{ "/assets/katex/katex.min.js" | relative_url }}"></script>
  <script defer src="{{ "/assets/katex/contrib/auto-render.min.js" | relative_url }}" onload="renderMathInElement(document.body)"></script>
  {% endif %}
  {% if site.comments.disqus_shortname and page.layout == "post" %}<script src="//{{ site.comments.disqus_shortname }}.disqus.com/embed.js" async></script>{% endif %}
  {% if site.comments.isso_domain and page.layout == "post" %}<script data-isso="http://{{ site.comments.isso_domain }}" src="//{{ site.comments.isso_domain }}/js/embed.min.js"></script>{% endif %}
  
  <style>
    /* Critical CSS for avoiding FOUC */
    .reveal, .reveal-left, .reveal-right {
      opacity: 0;
      transform: translateY(30px);
    }
  </style>
</head>
<body data-theme="forest">
  {% if site.show_sidebar or site.sidebar %}{% include sidebar.html %}{% endif %}

  {% if site.navigation %}
    {% assign pages = site.navigation %}
  {% else %}
    {% assign pages = site.pages | where_exp: "item", "item.title and item.sitemap != false" | sort: "order" %}
  {% endif %}

  <header>
    <a href="{{ "/" | relative_url }}" class="title">{{ site.title | escape }}</a>
    {% include menu.html menu=pages %}
  </header>

  {{ content }}

  {% if site.external %}
  <footer>
    <p class="footer-tagline">Data Science · Music · Sea</p>
    {% include menu.html menu=site.external %}
    <p class="footer-copyright">© {{ site.time | date: '%Y' }} {{ site.author | escape }}</p>
  </footer>
  {% endif %}

  <!-- Scroll Reveal Animation Script -->
  <script>
    (function() {
      // Check for reduced motion preference
      const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      
      if (prefersReducedMotion) {
        // Show all elements immediately if user prefers reduced motion
        document.querySelectorAll('.reveal, .reveal-left, .reveal-right').forEach(el => {
          el.style.opacity = '1';
          el.style.transform = 'none';
        });
        return;
      }
      
      // Intersection Observer for scroll reveals
      const observerOptions = {
        root: null,
        rootMargin: '0px 0px -50px 0px',
        threshold: 0.1
      };
      
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.classList.add('revealed');
            observer.unobserve(entry.target);
          }
        });
      }, observerOptions);
      
      // Observe all reveal elements
      document.querySelectorAll('.reveal, .reveal-left, .reveal-right').forEach(el => {
        observer.observe(el);
      });
      
      // Header scroll effect
      const header = document.querySelector('body > header');
      let lastScroll = 0;
      
      window.addEventListener('scroll', () => {
        const currentScroll = window.pageYOffset;
        
        if (currentScroll > 50) {
          header.classList.add('scrolled');
        } else {
          header.classList.remove('scrolled');
        }
        
        lastScroll = currentScroll;
      }, { passive: true });
    })();
  </script>

</body>
</html>
